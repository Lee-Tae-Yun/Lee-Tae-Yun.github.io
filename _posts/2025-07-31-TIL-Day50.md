---
title: "[Day 50] RxSwiftì™€ SearchControllerë¥¼ í™œìš©í•œ ê²€ìƒ‰ê¸°ëŠ¥ "
description: "RxSwiftì™€ Clean Architectureë¥¼ ì‚¬ìš©í•œ ì•± ê°œë°œ ì¼ê¸°"
date: 2025-07-31
categories: [TIL]
tags: [Swift, iOS, RxSwift, SearchController]
pin: false
math: true
mermaid: true
# published: false
# image:
#   path:
#   lqip: 
#   alt: 
---
## ğŸ˜­ ì™œ ë°ì´í„°ê°€ ì•ˆë„˜ì–´ê°€ì§€...?
ì˜¤ëŠ˜ì€ `SearchController`ë¥¼ ì‚¬ìš©í•´ì„œ ê²€ìƒ‰ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë ¤ê³ í–‡ëŠ”ë° ê²€ìƒ‰ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ê²€ìƒ‰ì–´ë¥¼ ë„˜ê²¨ì£¼ë ¤ê³  í–ˆëŠ”ë° ë°ì´í„°ê°€ ë‚˜ì˜¤ì§€ ì•Šì•˜ë‹¤...

ì˜ˆë¥¼ ë“¤ì–´, í™ˆ í™”ë©´ì˜ í…ìŠ¤íŠ¸ í•„ë“œì— `"ì•„ì´ì–¸ë§¨"`ì„ ì…ë ¥ì„ í•´ë„ `searchBar`ì˜`text`ê°€ ë¹„ì–´ìˆì—ˆë‹¤... ë°ì´í„°ëŠ” ì•„ë˜ì²˜ëŸ¼ ë„˜ê²¨ ì¤¬ë‹¤.

HomeViewì—ì„œ 
```swift
let container = DIContainer()
lazy var searchResultsVC = container.makeSearchViewController(query: self.searchTextRelay)

lazy var searchController = UISearchController (searchResultsController: searchResultsVC).then {
  ...
}
```
ì´ë ‡ê²Œ DIContainerë¥¼ ì‚¬ìš©í•´ì„œ ê°’ì„ ê°€ì§€ê³  ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ê³  í…ìŠ¤íŠ¸ ë³€í™” ê°ì§€ëŠ” UISearchBarUpdatingë¥¼ ì‚¬ìš©í•´ì„œ ì•„ë˜ì²˜ëŸ¼ ë„˜ê²¨ì¤¬ë‹¤

```swift
func updateSearchResults(for searchController: UISearchController) {
  searchController.searchBar.rx.text.orEmpty
    .bind(to: searchTextRelay)
    .disposed(by: disposeBag)
}
```

## ğŸ ë””ë²„ê¹… ê³¼ì •

ì´ì œ SearchViewControllerë¡œ ê°€ì„œ 

```swift
private func bindViewModel() {
  queryRelay
    .map {
      .search($0)
    }
    .bind(to: viewModel.action)
    .disposed(by: disposeBag)

  viewModel.state
    .subscribe(onNext: { state in
      print("ë°›ì€ ë°ì´í„°", state)
    })
    .disposed(by: disposeBag)
}
```

ì´ë ‡ê²Œ í•´ì„œ ë¡œê·¸ë¥¼ ì°ì–´ë´¤ëŠ”ë°... ê²°ê³¼ëŠ” 
```zsh
ë°›ì€ ë°ì´í„° State(movieresults: [], podcastresults: [], searchResult: [iTunes_SearchApp.SearchResult(movies: [], podcasts: [])], errorMessage: nil)
-[RTIInputSystemClient remoteTextInputSessionWithID:performInputOperation:]  perform input operation requires a valid sessionID. inputModality = Keyboard, inputOperation = <null selector>, customInfoType = UIEmojiSearchOperations
```
ì´ë ‡ê²Œ ë¡œê·¸ê°€ ì°í˜”ë‹¤. 

## â‰ï¸ ë¬¸ì œì˜ ì›ì¸
ë¬¸ì œëŠ” ë°ì´í„°ê°€ `SearchController`ì˜ `text`ê°€ `SearchViewController`ë¡œ ë„˜ì–´ê°€ì§€ ì•Šì•˜ë‹¤.

ê·¸ë˜ì„œ ë­ê°€ ë¬¸ì œì¼ê¹Œ.... í•˜ê³  ê³ ë¯¼ì„ í–ˆë”ë‹ˆ ë„˜ê²¨ì£¼ëŠ” ë°©ì‹ì´ ì˜ëª»ëë˜ ê²ƒì´ë‹¤...

`updateSearchResults`ë¡œ ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ë©´ ì•ˆëì—ˆë‹¤.....

ë‚˜ëŠ” ê²€ìƒ‰ì–´ê°€ ë°”ë€”ë•Œ ë§ˆë‹¤ í˜¸ì¶œí•œë‹¤ ë¼ê³  ìƒê°ì„í•˜ê³  `updateSearchResults`ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ë„˜ê²¨ì¤˜ì•¼ì§€ í•˜ê³  ì‚¬ìš©ì„ í–ˆëŠ”ë° ì´ê±´ ì „í˜€ RxìŠ¤ëŸ½ì§€ ì•Šì€ ê±°ì˜€ë‹¤, ê·¸ ì´ìœ ëŠ” ì•„ë˜ì™€ ê°™ë‹¤

`updateSearchResults`ëŠ” ê²€ìƒ‰ì–´ê°€ ë°”ë€Œë©´ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì¸ë° ì—¬ê¸°ì„œ ë°”ì¸ë”©ì„ ê±¸ì–´ë²„ë¦¬ë‹ˆê¹Œ ê²€ìƒ‰ì–´ê°€ ë°”ë€”ë•Œ ë§ˆë‹¤ ê³„ì†í•´ì„œ ìƒˆë¡œìš´ ë°”ì¸ë”©ì„ ì¶”ê°€í•˜ëŠ” ì…ˆì´ ë˜ë²„ë ¤ì„œ **`memory leakì´ë‚˜ unexpected behaviorê°€ ë°œìƒ`** í•´ë²„ë¦°ê²ƒì´ì˜€ë‹¤.. ê·¸ë˜ì„œ ë°ì´í„°ëŠ” ë„˜ì–´ê°€ì§€ ì•Šì•˜ë˜ê²ƒ...

## í•´ê²°ë°©ë²•

ê·¸ë˜ì„œ ì•„ê¹Œ íŒ€ì›ë“¤ì´ë‘ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©´ì„œ ë“¤ì—ˆë˜ ì´ì•¼ê¸°ê°€ ìˆì—ˆë‹¤. ë°”ì¸ë”©ì€ ë°”ì¸ë”© í•¨ìˆ˜ì—ì„œë§Œ í•œë²ˆë§Œ ê±¸ì–´ì¤˜ì•¼í•œë‹¤ê³ . ê·¸ ë§ì´ ìƒê°ì´ë‚˜ì„œ ë°”ë¡œ ì´ë ‡ê²Œ ì˜®ê²¨ì¤¬ë‹¤...

```swift
private func bindViewModel() {
  searchController.searchBar.rx.text.orEmpty
    .bind(to: searchTextRelay)
    .disposed(by: disposeBag)
  
 ...
}
```

ì´ë ‡ê²Œ ë°”ì¸ë”©ì€ í•œë²ˆë§Œ í•˜ê²Œë” ë°”ì¸ë”© í•¨ìˆ˜ ì•ˆì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ë”ë‹ˆ?!

```zsh
ì „ë‹¬ë°›ì€ ê²€ìƒ‰ì–´: ìŠ¤íŒŒì´ë”ë§¨
ë°›ì€ ë°ì´í„° State(movieresults: [iTunes_SearchApp.Movie(trackName: "Spider-Man: Far From Home", artistName: "Jon Watts", longDescription: "Peter Parker returns in Spider-Man: Far From Home, ...
```
ë°ì´í„°ê°€ ì˜ ë„˜ì–´ì™”ë‹¤!!!

~~ì‚¬ì‹¤ ì¤‘ê°„ì— Entityëª…ì— ì˜¤íƒ€ê°€ ë‚¬ì–´ì„œ ì—ëŸ¬ í•œë²ˆ ë‚œê±´ ë¹„ë°€~~


## ë§ºìœ¼ë©°: ì¶˜ì‹ì´ì™€ í•¨ê»˜í•˜ëŠ” ìŠ¤ë§ˆíŠ¸í•œ ê°œë°œ

ì•„ì§ RxSwiftê°€ ë¬¸ë²•ì´ ìµìˆ™í•˜ì§€ ì•Šì•„ì„œ ì–´ë–¤ê³³ì— ì½”ë“œë¥¼ ì‘ì„±ì„ í•´ì•¼í•˜ëŠ”ì§€, ì–´ë–»ê²Œ ì‘ì„±ì„ í•´ì•¼í•˜ëŠ”ì§€ ê°ì´ ì˜ ì•ˆì¡íˆì§€ë§Œ ì´ë ‡ê²Œ ì˜¤ë¥˜ë„ ë‚´ë©´ì„œ, ì‚¬ìš©í•´ë³´ë©´ì„œ í•˜ë©´ ì´í•´ê°€ ë˜ê¸° ì‹œì‘í•˜ê³ ìˆë‹¤.

ì´ë²ˆì— Reactive Rrogrammingì„ ë°°ìš°ë©´ì„œ ì •ë§ ë„ˆë¬´ ì–´ë µê³  í˜ë“¤ì—ˆëŠ”ë°, í™•ì‹¤íˆ ì‚¬ëŒë§ˆë‹¤ í•™ìŠµí•˜ëŠ” ë°©ì‹ì´ ë‹¤ë¥´ê² ì§€ë§Œ, ì¡°ê¸ˆì”© ì½”ë“œë¥¼ ë”°ë¼ì¹˜ë©´ì„œë¼ë„ í•´ë³´ë‹ˆê¹Œ ì¡°ê¸ˆì”© ë‹¤ì‹œ ìì‹ ê°ì´ ìƒê¸°ëŠ”ê±°ê°™ë‹¤.

**ì˜¤ëŠ˜ë„ ì˜¤ë¥˜ ë‚´ë©° ìë€ ì¶˜ì‹ì´ì˜€ìŠµë‹ˆë‹¤. ğŸ¾**
**ë” ì—´ì‹¬íˆ ë…¸ë ¥ í•´ì„œ ì¢‹ì€ iOS Developerê°€ ë˜ì!**

> **í˜¹ì‹œ ì´ ê¸€ì„ ë³´ì‹œëŠ” ë¶„ë“¤ ì¤‘ ë” ìœ ìš©í•œ íŒì´ ìˆë‹¤ë©´ ëŒ“ê¸€ë¡œ ë§ì´ ì•Œë ¤ì£¼ì„¸ìš”!**